<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>小花生</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="./font-awesome-4.7.0/css/font-awesome.css"/>
    <link rel="stylesheet" type="text/css" href="./css/pgy.css">
</head>

<style>
    #myCarousel {
        height: 300px;
    }

    .carousel-inner > .item > img, .carousel-inner > .item > a > img {
        height: 300px;
        margin: 0 auto;
    }

    .diary {
        border-bottom: 1px solid #f2dede;
        padding: 20px;
    }

    .footer {
        text-align: center;
        padding: 2em 0 0;
    }

    .footer p {
        font-size: 1em;
        color: #B47C9F;
        margin: 0;
    }

    .footer p a {
        color: #fff;
    }

    .footer p a:hover {
        color: #B47C9F;
    }
</style>
<body>
<div style="display: flex;justify-content: space-between; border-radius: 15px; background-color: #f2dede;"
     class="panel">
    <div style="padding: 10px;">
        <img src="img/peanut.png" style="height: 30px;"/>
    </div>
    <div class="btn-group" style="padding-top: 7px; padding-right: 20px;">
        <button class="btn btn-info">
            <a href="/write.html" style="text-decoration:none">记一笔</a>
        </button>
        <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
            个人中心
        </button>
        <ul class="dropdown-menu">
            <li><a href="#" onclick="alert('暂未开放！敬请期待！')">我的记录</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/logout">退出登录</a></li>
        </ul>
    </div>
</div>

<section>
    <div class="container">
        <div id="myCarousel" class="carousel slide">
            <!-- 轮播（Carousel）指标 -->
            <ol class="carousel-indicators">
                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                <li data-target="#myCarousel" data-slide-to="1"></li>
                <li data-target="#myCarousel" data-slide-to="2"></li>
                <li data-target="#myCarousel" data-slide-to="3"></li>
                <li data-target="#myCarousel" data-slide-to="4"></li>
            </ol>
            <!-- 轮播（Carousel）项目 -->
            <div class="carousel-inner">
                <div class="item active">
                    <img alt="First slide" class="cycle_img">
                    <div class="carousel-caption">小宝贝</div>
                </div>
                <div class="item">
                    <img alt="Second slide" class="cycle_img">
                    <div class="carousel-caption">小可爱</div>
                </div>
                <div class="item">
                    <img alt="Third slide" class="cycle_img">
                    <div class="carousel-caption">小花生</div>
                </div>
                <div class="item">
                    <img alt="Third slide" class="cycle_img">
                    <div class="carousel-caption">小乌龟</div>
                </div>
                <div class="item">
                    <img alt="Third slide" class="cycle_img">
                    <div class="carousel-caption">小仙女</div>
                </div>
            </div>
            <!-- 轮播（Carousel）导航 -->
            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev"> <span
                    class="glyphicon glyphicon-chevron-left"
                    aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next"> <span
                    class="glyphicon glyphicon-chevron-right"
                    aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
</section>
<br/>
<div class="container">
    <div class="row">
        <div class="col-md-9">
            <div class="panel panel-danger">
                <div class="panel-heading">小本本</div>
                <div class="panel-body" id="diaryList">
                    <div v-for="diary in diaries" class="diary row">
                        <div class="col-md-4">
                            <img src="img/peanut.png" height="100px;"/>
                        </div>
                        <div class="col-md-8">
                            <!--                            <a v-bind:href="'detail.html?'+diary.id"><h2 v-text="diary.content.substring(3,10)">标题</h2></a>-->
                            <!--创建时间-->
                            <span class="glyphicon glyphicon-time" v-text="diary.created"></span>
                            <!--预览文本-->
                            <p v-html="diary.content" class="preview"></p>
                            <!--浏览量-->
                            <span class="fa fa-eye" v-text="' '+diary.viewCount"></span>
                            <span class="glyphicon glyphicon-pencil">
                                <span v-if="diary.userId==1">小花生</span>
                                <span v-else>臭男人</span>
                            </span>
                            <a v-bind:href="'detail.html?'+diary.id">
                                <button class="btn btn-info">查看详情</button>
                            </a>
<!--                            <a v-if="diary.userId==userId" v-bind:href="'/api/v1/diary/delete/'+diary.id">-->
<!--                                <button class="btn btn-danger">删除</button>-->
<!--                            </a>-->
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <button class="btn btn-success" id="getMore">加载更多</button>
                    <a href="#myCarousel">
                        <button class="pull-right btn btn-info" >回到顶部</button>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <ul class="list-group">
                <li class="list-group-item list-group-item-heading list-group-item-danger">
                    给小花生的小礼物
                </li>
                <li class="list-group-item">
                    <a href="love.html">I LOVE YOU</a>
                </li>
                <li class="list-group-item">
                    <a href="redHeart.html">JUST FOR YOU</a>
                </li>
            </ul>
            <ul class="list-group">
                <li class="list-group-item list-group-item-heading list-group-item-danger">
                    小花生的照片集
                </li>
                <li class="list-group-item">
                    <a href="heart_album.html">给你一颗小心心</a>
                </li>
                <li class="list-group-item">
                    <a href="cube.html">给你一个小方块</a>
                </li>
                <li class="list-group-item">
                    <a href="cube_rotate.html">还有一个小方块</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="dandelion">
    <span class="smalldan"></span>
    <span class="bigdan"></span>
</div>
<div class="footer">
    <p>
        &copy 2019-2020 <a href="https://fx7.top" style="color: #000"> 人家故里 </a>All rights reserved
    </p>
</div>
</body>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/bootstrap.js"></script>
<script type="text/javascript" src="./js/holder.js"></script>
<script type="text/javascript" src="./js/html5shiv.min.js"></script>
<script type="text/javascript" src="./js/css3-mediaqueries.js"></script>
<script type="text/javascript" src="./js/respond.min.js"></script>
<script type="text/javascript" src="./js/vue.min.js"></script>
<!--<script type="text/javascript" src="./js/mouseClick.js"></script>-->
<script type="text/javascript" src="./js/snowstorm-min.js"></script>
<script type="text/javascript">
    snowStorm.snowColor = '#31B0D5'; //蓝色的雪！
    snowStorm.flakesMaxActive = 96; //一次在萤幕上显示更多雪
    snowStorm.useTwinkleEffect = true; //让雪在视线中闪烁

    //初始化轮播图 让轮播图自己动
    $("#myCarousel").carousel("cycle");

    let diaryApp = new Vue({
        el: "#diaryList",
        data: {
            diaries: [],
            userId: 0
        },
        methods: {
            loadDiaryList: function () {
                $.ajax({
                    url: '/api/v1/diary/getDiaries/0',
                    success: function (json) {
                        let diaries = [];
                        // console.log(json)
                        for (let i = 0; i < json.data.length; i++) {
                            diaries[i] = json.data[i];
                            if (diaries[i].content.length > 50) {
                                diaries[i].content = diaries[i].content.substring(0, 50) + '...'
                            }
                        }
                        diaryApp.diaries = diaries
                    }
                });
            },
            loadPic: function () {
                let prefix = 'https://cdn.jsdelivr.net/gh/raingnight/Blog_Pic/yinlu/yinlu_'
                let suffix = '.jpg'
                let imgs = $('.cycle_img');
                for (let i = 0; i < imgs.length; i++) {
                    imgs[i].src = prefix + Math.floor(Math.random() * 100 + 1) + suffix
                }
            },
            getUserInfo:function (){
                $.ajax({
                    url:"/api/v1/user/userInfo",
                    success:function (json){
                        diaryApp.userId = json.id;
                    }
                })
            }
        },
        created: function () {
            this.loadDiaryList()
            //加载图片
            // this.loadPic()
            this.getUserInfo()
        }
    });
    $('#getMore').on('click', function () {
        let len = $('.diary').length;
        $.ajax({
            url: '/api/v1/diary/getDiary/' + len,
            success: function (json) {
                let diaries = [];
                // console.log(json)
                for (let i = 0; i < json.data.length; i++) {
                    diaries[i] = json.data[i];
                    if (diaries[i].content.length > 50) {
                        diaries[i].content = diaries[i].content.substring(0, 50) + '...'
                    }
                }
                let oldDiary = diaryApp.diaries;
                diaryApp.diaries = oldDiary.concat(diaries);
            }
        });
    })
</script>
</html>
